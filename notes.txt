//! strategies.js -the entire module- before optimizing with DRY principles (BEGINNING)
//? -----------------------------------------------------

/*
const GoogleStrategy = require("passport-google-oauth20").Strategy;
const FacebookStrategy = require("passport-facebook").Strategy;
const { User } = require("./../database/db");


// (NOTES: @STRATEGIES 001)
//* "local" strategy is the passportAuth file

! creates a "google" strategy (OAuth 2.0)
exports.googleStrategy = new GoogleStrategy({
    clientID: process.env.GOOGLE_CLIENT_ID,
    clientSecret: process.env.GOOGLE_CLIENT_SECRET,
    callbackURL: process.env.GOOGLE_CALLBACK_URL,
    userProfileURL: process.env.GOOGLE_USER_PROFILE_URL,
},
    function (accessToken, refreshToken, profile, done) {
        ! IMPORTANT: You must install mongoose-findorcreate package before using the method
        User.findOrCreate({ username: profile._json.email }, async function (err, user) {
            if (!err) {
                const newGoogleAccountObj = { accountType: "google", uid: profile.id };
                await createNewAccountHelper(user, newGoogleAccountObj);
                return done(err, user);
            } else {
                console.log(err);
            }
        });
    }
);

! creates a "facebook" strategy (OAuth 2.0)
exports.facebookStrategy = new FacebookStrategy(
    {
        clientID: process.env.FACEBOOK_CLIENT_ID,
        clientSecret: process.env.FACEBOOK_CLIENT_SECRET,
        callbackURL: process.env.FACEBOOK_CALLBACK_URL,
        profileFields: ["id", "displayName", "email"]
    },
    function (accessToken, refreshToken, profile, done) {
        ! IMPORTANT: You must install mongoose-findorcreate package before using the method
        User.findOrCreate({ username: profile._json.email }, async function (err, user) {
            if (!err) {
                const newFacebookAccObj = { accountType: "facebook", uid: profile._json.id };
                await createNewAccountHelper(user, newFacebookAccObj);
                return done(err, user);
            } else {
                console.log(err);
            }
        });
    }
);

* This helper function is invoked while instantiating new strategies (ex: facebook, google, etc.)
function createNewAccountHelper(user, newAccountObj) {
    // Create new map for a users account property -ONLY ONCE- (note: an empty map is still falsy)
    if (user && !user.accounts) {
        user.accounts = new Map();
        user.accounts.set(newAccountObj.accountType, newAccountObj);
        user.save();
    }
    // If the specified account does not exists in the already existing account map
    else if (!user.accounts.get(newAccountObj.accountType)) {
        user.accounts.set(newAccountObj.accountType, newAccountObj);
        user.save();
    }
    console.log(`${newAccountObj.accountType} account added to accounts map on USER: `, user);
    return user;
}



    <script type="text/javascript">
      // Single Page Apps for GitHub Pages
      // https://github.com/rafrex/spa-github-pages
      // Copyright (c) 2016 Rafael Pedicini, licensed under the MIT License
      // ----------------------------------------------------------------------
      // This script checks to see if a redirect is present in the query string
      // and converts it back into the correct url and adds it to the
      // browser's history using window.history.replaceState(...),
      // which won't cause the browser to attempt to load the new url.
      // When the single page app is loaded further down in this file,
      // the correct url will be waiting in the browser's history for
      // the single page app to route accordingly.
      // (function (l) {
      //   if (l.search) {
      //     var q = {};
      //     l.search.slice(1).split('&').forEach(function (v) {
      //       var a = v.split('=');
      //       q[a[0]] = a.slice(1).join('=').replace(/~and~/g, '&');
      //     });
      //     if (q.p !== undefined) {
      //       window.history.replaceState(null, null,
      //         l.pathname.slice(0, -1) + (q.p || '') +
      //         (q.q ? ('?' + q.q) : '') +
      //         l.hash
      //       );
      //     }
      //   }
      // }(window.location))
    </script>

    "homepage": "http://ratta2ii.github.io/mern-stack-authorization",

    "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "dev": "concurrently \"react-scripts start\" \"nodemon ./../server/server.js\"",
    "test": "react-scripts test",
    "eject": "react-scripts eject",
    "predeploy": "npm run build",
    "deploy": "gh-pages -d build",
  },


  CLIENT .env
  PUBLIC_URL=/mern-stack-authorization
*/

//! strategies.js -the entire module- before optimizing with DRY principles (END)
//? -----------------------------------------------------